---
- hosts: desktops laptops
  vars:
    country_code: CA
    system_locale: en_{{ country_code }}
    system_encoding: UTF-8
    system_timezone: America/Toronto
    system_keymap: emacs
    borg_repo: /data/backup
  handlers:
    - name: rebuild initramfs
      command: mkinitcpio -P

    - name: mirrorlist update
      pacman:
        update_cache: yes
        force: yes
      tags:
        - update

    - name: grub config
      command: grub-mkconfig -o /boot/grub/grub.cfg
      listen: kernel update

    - name: remount data dir
      command: mount -o remount /data

  tasks:
    - include_tasks: alltasks.yml

- hosts: laptops
  roles:
    - battery-saver
