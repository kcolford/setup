- name: set local hostname
  copy:
    dest: /etc/hostname
    content: |
      {{ inventory_hostname }}

- name: set console keymap
  lineinfile:
    path: /etc/vconsole.conf
    line: KEYMAP={{ system_keymap }}
    regexp: ^KEYMAP
    create: yes

- name: setup system locale
  locale_gen:
    name: "{{ system_locale }}.{{ system_encoding }}"

- name: set locale
  lineinfile:
    path: /etc/locale.conf
    line: LANG={{ system_locale }}.{{ system_encoding }}
    regexp: ^LANG=
    create: yes

- name: set console font
  lineinfile:
    path: /etc/vconsole.conf
    line: FONT=Lat2-Terminus16
    regexp: ^FONT
    create: yes

- name: set timezone
  file:
    src: /usr/share/zoneinfo/{{ system_timezone }}
    dest: /etc/localtime
    state: link

- name: automatically trim the system
  service:
    name: fstrim.timer
    enabled: yes

- name: fix mount options
  loop: "{{ ansible_mounts }}"
  mount:
    opts: noatime,nofail,{{ item.options }}
    fstype: auto
    path: "{{ item.mount }}"
    state: mounted
    src: UUID={{ item.uuid }}
